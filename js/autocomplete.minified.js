(function(d){d.fn.extend({autocomplete:function(a,b){var j=typeof a=="string";b=d.extend({},d.Autocompleter.defaults,{url:j?a:null,data:j?null:a,delay:j?d.Autocompleter.defaults.delay:10,max:b&&!b.scroll?10:150},b);b.highlight=b.highlight||function(l){return l};b.formatMatch=b.formatMatch||b.formatItem;return this.each(function(){new d.Autocompleter(this,b)})},result:function(a){return this.bind("result",a)},search:function(a){return this.trigger("search",[a])},flushCache:function(){return this.trigger("flushCache")}, setOptions:function(a){return this.trigger("setOptions",[a])},unautocomplete:function(){return this.trigger("unautocomplete")}});d.Autocompleter=function(a,b){function j(){var e=p.selected();if(!e)return false;var k=e.result;s=k;if(b.multiple){var q=o(i.val());if(q.length>1)k=q.slice(0,q.length-1).join(b.multipleSeparator)+b.multipleSeparator+k;k+=b.multipleSeparator}i.val(k);t();i.trigger("result",[e.data,e.value]);return true}function l(e,k){if(h==f.DEL)p.hide();else{var q=i.val();if(!(!k&&q==s)){s= q;q=m(q);if(q.length>=b.minChars){i.addClass(b.loadingClass);b.matchCase||(q=q.toLowerCase());c(q,g,t)}else{i.removeClass(b.loadingClass);p.hide()}}}}function o(e){if(!e)return[""];e=e.split(b.multipleSeparator);var k=[];d.each(e,function(q,v){if(d.trim(v))k[q]=d.trim(v)});return k}function m(e){if(!b.multiple)return e;e=o(e);return e[e.length-1]}function t(){var e=p.visible();p.hide();clearTimeout(r);i.removeClass(b.loadingClass);b.mustMatch&&i.search(function(k){if(!k)if(b.multiple){k=o(i.val()).slice(0, -1);i.val(k.join(b.multipleSeparator)+(k.length?b.multipleSeparator:""))}else i.val("")});e&&d.Autocompleter.Selection(a,a.value.length,a.value.length)}function g(e,k){if(k&&k.length&&n){i.removeClass(b.loadingClass);p.display(k,e);var q=k[0].value;if(b.autoFill&&m(i.val()).toLowerCase()==e.toLowerCase()&&h!=f.BACKSPACE){i.val(i.val()+q.substring(m(s).length));d.Autocompleter.Selection(a,s.length,s.length+q.length)}p.show()}else t()}function c(e,k,q){b.matchCase||(e=e.toLowerCase());var v=u.load(e); if(v&&v.length)k(e,v);else if(typeof b.url=="string"&&b.url.length>0){var A={timestamp:+new Date};d.each(b.extraParams,function(y,w){A[y]=typeof w=="function"?w():w});d.ajax({mode:"abort",port:"autocomplete"+a.name,dataType:b.dataType,url:b.url,data:d.extend({q:m(e),limit:b.max},A),success:function(y){var w;if(!(w=b.parse&&b.parse(y))){w=[];y=y.split("\n");for(var C=0;C<y.length;C++){var B=d.trim(y[C]);if(B){B=B.split("|");w[w.length]={data:B,value:B[0],result:b.formatResult&&b.formatResult(B,B[0])|| B[0]}}}w=w}w=w;u.add(e,w);k(e,w)}})}else{p.emptyList();q(e)}}var f={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},i=d(a).attr("autocomplete","off").addClass(b.inputClass),r,s="",u=d.Autocompleter.Cache(b),n=0,h,x={mouseDownOnSelect:false},p=d.Autocompleter.Select(b,a,j,x),z;d.browser.opera&&d(a.form).bind("submit.autocomplete",function(){if(z)return z=false});i.bind((d.browser.opera?"keypress":"keydown")+".autocomplete",function(e){h=e.keyCode;switch(e.keyCode){case f.UP:e.preventDefault(); p.visible()?p.prev():l(0,true);break;case f.DOWN:e.preventDefault();p.visible()?p.next():l(0,true);break;case f.PAGEUP:e.preventDefault();p.visible()?p.pageUp():l(0,true);break;case f.PAGEDOWN:e.preventDefault();p.visible()?p.pageDown():l(0,true);break;case b.multiple&&d.trim(b.multipleSeparator)==","&&f.COMMA:case f.TAB:case f.RETURN:if(j()){e.preventDefault();z=true;return false}break;case f.ESC:p.hide();break;default:clearTimeout(r);r=setTimeout(l,b.delay)}}).focus(function(){n++}).blur(function(){n= 0;if(!x.mouseDownOnSelect){clearTimeout(r);r=setTimeout(t,200)}}).click(function(){n++>1&&!p.visible()&&l(0,true)}).bind("search",function(){function e(q,v){var A;if(v&&v.length)for(var y=0;y<v.length;y++)if(v[y].result.toLowerCase()==q.toLowerCase()){A=v[y];break}typeof k=="function"?k(A):i.trigger("result",A&&[A.data,A.value])}var k=arguments.length>1?arguments[1]:null;d.each(o(i.val()),function(q,v){c(v,e,e)})}).bind("flushCache",function(){u.flush()}).bind("setOptions",function(e,k){d.extend(b, k);"data"in k&&u.populate()}).bind("unautocomplete",function(){p.unbind();i.unbind();d(a.form).unbind(".autocomplete")})};d.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:false,matchSubset:true,matchContains:false,cacheLength:10,max:100,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(a){return a[0]},formatMatch:null,autoFill:false,width:0,multiple:false,multipleSeparator:", ",highlight:function(a, b){return a.replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:true,scrollHeight:180};d.Autocompleter.Cache=function(a){function b(g,c){a.matchCase||(g=g.toLowerCase());var f=g.indexOf(c);if(a.matchContains=="word")f=g.toLowerCase().search("\\b"+c.toLowerCase());if(f==-1)return false;return f==0||a.matchContains}function j(g,c){t>a.cacheLength&&o();m[g]||t++;m[g]=c}function l(){if(!a.data)return false; var g={},c=0;if(!a.url)a.cacheLength=1;g[""]=[];for(var f=0,i=a.data.length;f<i;f++){var r=a.data[f];r=typeof r=="string"?[r]:r;var s=a.formatMatch(r,f+1,a.data.length);if(s!==false){var u=s.charAt(0).toLowerCase();g[u]||(g[u]=[]);r={value:s,data:r,result:a.formatResult&&a.formatResult(r)||s};g[u].push(r);c++<a.max&&g[""].push(r)}}d.each(g,function(n,h){a.cacheLength++;j(n,h)})}function o(){m={};t=0}var m={},t=0;setTimeout(l,25);return{flush:o,add:j,populate:l,load:function(g){if(!a.cacheLength|| !t)return null;if(!a.url&&a.matchContains){var c=[],f;for(f in m)if(f.length>0){var i=m[f];d.each(i,function(r,s){b(s.value,g)&&c.push(s)})}return c}else if(m[g])return m[g];else if(a.matchSubset)for(f=g.length-1;f>=a.minChars;f--)if(i=m[g.substr(0,f)]){c=[];d.each(i,function(r,s){if(b(s.value,g))c[c.length]=s});return c}return null}}};d.Autocompleter.Select=function(a,b,j,l){function o(){if(s){u=d("<div/>").hide().addClass(a.resultsClass).css("position","absolute").appendTo(document.body);n=d("<ul/>").appendTo(u).mouseover(function(h){if(m(h).nodeName&& m(h).nodeName.toUpperCase()=="LI"){f=d("li",n).removeClass(g.ACTIVE).index(m(h));d(m(h)).addClass(g.ACTIVE)}}).click(function(h){d(m(h)).addClass(g.ACTIVE);j();b.focus();return false}).mousedown(function(){l.mouseDownOnSelect=true}).mouseup(function(){l.mouseDownOnSelect=false});a.width>0&&u.css("width",a.width);s=false}}function m(h){for(h=h.target;h&&h.tagName!="LI";)h=h.parentNode;if(!h)return[];return h}function t(h){c.slice(f,f+1).removeClass(g.ACTIVE);f+=h;if(f<0)f=c.size()-1;else if(f>=c.size())f= 0;h=c.slice(f,f+1).addClass(g.ACTIVE);if(a.scroll){var x=0;c.slice(0,f).each(function(){x+=this.offsetHeight});if(x+h[0].offsetHeight-n.scrollTop()>n[0].clientHeight)n.scrollTop(x+h[0].offsetHeight-n.innerHeight());else x<n.scrollTop()&&n.scrollTop(x)}}var g={ACTIVE:"ac_over"},c,f=-1,i,r="",s=true,u,n;return{display:function(h,x){o();i=h;r=x;n.empty();for(var p=a.max&&a.max<i.length?a.max:i.length,z=0;z<p;z++)if(i[z]){var e=a.formatItem(i[z].data,z+1,p,i[z].value,r);if(e!==false){e=d("<li/>").html(a.highlight(e, r)).addClass(z%2==0?"ac_even":"ac_odd").appendTo(n)[0];d.data(e,"ac_data",i[z])}}c=n.find("li");if(a.selectFirst){c.slice(0,1).addClass(g.ACTIVE);f=0}d.fn.bgiframe&&n.bgiframe()},next:function(){t(1)},prev:function(){t(-1)},pageUp:function(){f!=0&&f-8<0?t(-f):t(-8)},pageDown:function(){f!=c.size()-1&&f+8>c.size()?t(c.size()-1-f):t(8)},hide:function(){u&&u.hide();c&&c.removeClass(g.ACTIVE);f=-1},visible:function(){return u&&u.is(":visible")},current:function(){return this.visible()&&(c.filter("."+ g.ACTIVE)[0]||a.selectFirst&&c[0])},show:function(){var h=d(b).offset();u.css({width:typeof a.width=="string"||a.width>0?a.width:d(b).width(),top:h.top+b.offsetHeight,left:h.left}).show();if(a.scroll){n.scrollTop(0);n.css({maxHeight:a.scrollHeight,overflow:"auto"});if(d.browser.msie&&typeof document.body.style.maxHeight==="undefined"){var x=0;c.each(function(){x+=this.offsetHeight});h=x>a.scrollHeight;n.css("height",h?a.scrollHeight:x);h||c.width(n.width()-parseInt(c.css("padding-left"))-parseInt(c.css("padding-right")))}}}, selected:function(){var h=c&&c.filter("."+g.ACTIVE).removeClass(g.ACTIVE);return h&&h.length&&d.data(h[0],"ac_data")},emptyList:function(){n&&n.empty()},unbind:function(){u&&u.remove()}}};d.Autocompleter.Selection=function(a,b,j){if(a.createTextRange){var l=a.createTextRange();l.collapse(true);l.moveStart("character",b);l.moveEnd("character",j);l.select()}else if(a.setSelectionRange)a.setSelectionRange(b,j);else if(a.selectionStart){a.selectionStart=b;a.selectionEnd=j}a.focus()}})(jQuery); (function(d){var a=d.ajax,b={},j=[],l=[];d.ajax=function(o){o=jQuery.extend(o,jQuery.extend({},jQuery.ajaxSettings,o));var m=o.port;switch(o.mode){case "abort":b[m]&&b[m].abort();return b[m]=a.apply(this,arguments);case "queue":var t=o.complete;o.complete=function(){t&&t.apply(this,arguments);jQuery([a]).dequeue("ajax"+m)};jQuery([a]).queue("ajax"+m,function(){a(o)});return;case "sync":var g=j.length;j[g]={error:o.error,success:o.success,complete:o.complete,done:false};l[g]={error:[],success:[],complete:[]}; o.error=function(){l[g].error=arguments};o.success=function(){l[g].success=arguments};o.complete=function(){l[g].complete=arguments;j[g].done=true;if(g==0||!j[g-1])for(var c=g;c<j.length&&j[c].done;c++){j[c].error&&j[c].error.apply(jQuery,l[c].error);j[c].success&&j[c].success.apply(jQuery,l[c].success);j[c].complete&&j[c].complete.apply(jQuery,l[c].complete);j[c]=null;l[c]=null}}}return a.apply(this,arguments)}})(jQuery);